import{r as f,n as D,o as i,c as d,d as t,w as a,f as y,aj as k,S as g,e as h,ak as U,al as E,af as s,W as b,am as C,an as V,g as z,i as B,ar as N,h as T,V as w,at as q,j as p,b8 as A,k as r,t as _,Q as v}from"./index.1a0de457.js";import{V as F}from"./VDialog.82bebf55.js";import{V as O}from"./VLabel.23c4fa6c.js";import{V as x}from"./VRadio.49854e28.js";import{v as $}from"./index.dae76202.js";import"./VSelectionControl.ce910cc4.js";const j={id:"orders"},L=s("h1",{class:"text-center"},"\u7BA1\u7406\u8005\u8A02\u55AE\u7BA1\u7406",-1),P=s("thead",null,[s("tr",null,[s("th",null,"\u8A02\u55AE\u7DE8\u865F"),s("th",null,"\u8A02\u8CFC\u6703\u54E1"),s("th",null,"\u8A02\u8CFC\u65E5\u671F"),s("th",null,"\u8A02\u55AE\u91D1\u984D"),s("th",null,"\u5546\u54C1\u540D\u7A31"),s("th",null,"\u8655\u7406\u72C0\u614B"),s("th",null,"\u7BA1\u7406")])],-1),I={key:0},M={key:1},Q={key:2},W=r("mdi-comment-outline"),G=r("\u8A02\u55AE\u78BA\u8A8D\u4E2D "),H={key:3},J=r("mdi-comment-processing-outline"),K=r("\u5546\u54C1\u51FA\u8CA8\u4E2D "),X={key:4},Y=r("mdi-comment-check-outline"),Z=r("\u8A02\u55AE\u5DF2\u5B8C\u6210 "),tt=r("\u7DE8\u8F2F"),et={key:0},lt=s("td",{colspan:"5"},[s("h3",{class:"text-center"},"\u6C92\u6709\u8A02\u55AE")],-1),ot=[lt],at=s("div",{class:"text-h5"},"\u7DE8\u8F2F\u8A02\u55AE",-1),st=r("\u8A02\u55AE\u522A\u9664"),nt=r("\u53D6\u6D88"),it=r("\u78BA\u8A8D\u9001\u51FA"),pt={__name:"OrdersView",setup(dt){const u=f([]),e=f({_id:"",email:"",tone:"",category:"\u8A02\u55AE\u78BA\u8A8D\u4E2D",dialog:!1,valid:!1,submitting:!1,idx:-1});f(["\u8A02\u55AE\u78BA\u8A8D\u4E2D","\u51FA\u8CA8\u4E2D","\u8A02\u55AE\u5B8C\u6210"]),f({required(n){return!!n||"\u5FC5\u586B"},email(n){return $.exports.isEmail(n)||"\u4FE1\u7BB1\u683C\u5F0F\u932F\u8AA4"}}),D(()=>u.slice(0).reverse());const R=(n,o)=>{e._id=u[o]._id,e.tone=u[o].tone,e.idx=o,e.dialog=!0,e.valid=!1,e.submitting=!1},S=async()=>{e.submitting=!0;try{const{data:n}=await k.patch("/orders/"+e._id,e);u[e.idx]=n.result,g.fire({title:"success //\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),e.dialog=!1}catch(n){g.fire({title:"ERROR //\u5931\u6557",text:n.isAxiosError?n.response.data.message:n.message})}e.submitting=!1};return(async()=>{try{const{data:n}=await k.get("/orders/all");u.push(...n.result.map(o=>(o.totalPrice=o.products.reduce((l,m)=>l+m.product.price*m.quantity,0),o)))}catch(n){console.log(n),g.fire({title:"ERROR //\u5931\u6557",text:"\u7121\u6CD5\u53D6\u5F97\u8A02\u55AE"})}})(),(n,o)=>(i(),d("div",j,[t(y,null,{default:a(()=>[t(h,{cols:"12"},{default:a(()=>[L]),_:1}),t(U),t(h,{cols:"12"},{default:a(()=>[t(E,null,{default:a(()=>[P,s("tbody",null,[(i(!0),d(b,null,C(u,(l,m)=>(i(),d("tr",{key:l._id},[s("td",null,_(l._id),1),l.user===null?(i(),d("td",I,"\u5E33\u865F\u5DF2\u7D93\u522A\u9664")):(i(),d("td",M,_(l.user.email),1)),s("td",null,_(new Date(l.date).toLocaleDateString()),1),s("td",null,_(l.totalPrice),1),s("td",null,[s("ul",null,[(i(!0),d(b,null,C(l.products,c=>(i(),d("li",{key:c._id},_(c.product.name)+" x "+_(c.quantity),1))),128))])]),l.tone===0?(i(),d("td",Q,[t(v,{size:"x-large",start:"",color:"red"},{default:a(()=>[W]),_:1}),G])):V("",!0),l.tone===1?(i(),d("td",H,[t(v,{size:"x-large",start:"",color:"yellow"},{default:a(()=>[J]),_:1}),K])):V("",!0),l.tone===2?(i(),d("td",X,[t(v,{size:"x-large",start:"",color:"green"},{default:a(()=>[Y]),_:1}),Z])):V("",!0),s("td",null,[t(p,{onClick:c=>R(l._id,m),variant:"outlined",plain:"",size:"x-small",rounded:"lg"},{default:a(()=>[tt]),_:2},1032,["onClick"])])]))),128)),u.length===0?(i(),d("tr",et,ot)):V("",!0)])]),_:1})]),_:1})]),_:1}),t(F,{modelValue:e.dialog,"onUpdate:modelValue":o[6]||(o[6]=l=>e.dialog=l)},{default:a(()=>[t(z,{rounded:"xl"},{default:a(()=>[t(O,{modelValue:e.valid,"onUpdate:modelValue":o[5]||(o[5]=l=>e.valid=l),onSubmit:B(S,["prevent"])},{default:a(()=>[t(N,null,{default:a(()=>[at]),_:1}),t(T,null,{default:a(()=>[t(w,null,{default:a(()=>[t(y,null,{default:a(()=>[t(h,{cols:"12"},{default:a(()=>[t(x,{label:"\u8A02\u55AE\u78BA\u8A8D\u4E2D",color:"red",modelValue:e.tone,"onUpdate:modelValue":o[0]||(o[0]=l=>e.tone=l),value:"0"},null,8,["modelValue"]),t(x,{label:"\u5546\u54C1\u51FA\u8CA8\u4E2D",color:"yellow",modelValue:e.tone,"onUpdate:modelValue":o[1]||(o[1]=l=>e.tone=l),value:"1"},null,8,["modelValue"]),t(x,{label:"\u8A02\u55AE\u5DF2\u5B8C\u6210",color:"green",modelValue:e.tone,"onUpdate:modelValue":o[2]||(o[2]=l=>e.tone=l),value:"2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(w,{class:"d-flex"},{default:a(()=>[t(p,{onClick:o[3]||(o[3]=l=>n.delUser(n.idx)),color:"error"},{default:a(()=>[st]),_:1}),t(A),t(p,{onClick:o[4]||(o[4]=l=>e.dialog=!1),color:"error",variant:"tonal",disadled:e.submitting},{default:a(()=>[nt]),_:1},8,["disadled"]),t(p,{type:"submit",variant:"tonal",loading:e.submitting},{default:a(()=>[it]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}};export{pt as default};
