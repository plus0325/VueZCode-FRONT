import{r as V,ac as R,aw as S,o as n,c as u,d as l,w as o,f as b,aj as v,S as _,e as r,ak as E,al as T,af as d,W as A,am as B,an as D,g as F,i as N,ar as q,h as $,V as h,at as j,j as m,b8 as O,k as c,t as p}from"./index.7c3a01de.js";import{V as z}from"./VDialog.dbf19bfd.js";import{V as L}from"./VLabel.0b7dd55b.js";import{V as C}from"./VTextField.438cb3ef.js";import{V as M}from"./VCheckbox.d5f1ec7a.js";import{V as W}from"./VRadio.e527433d.js";import{v as G}from"./index.dae76202.js";import"./VSelectionControl.3dcb9fdf.js";const H={id:"admin-users"},I=d("h1",{class:"text-center"},"\u6703\u54E1\u7BA1\u7406",-1),J=d("thead",null,[d("tr",null,[d("th",null,"\u6703\u54E1\u7DE8\u865F"),d("th",null,"\u4FE1\u7BB1"),d("th",null,"\u5E33\u865F"),d("th",null,"\u662F\u5426\u7BA1\u7406\u54E1"),d("th",null,"\u7BA1\u7406")])],-1),K=c("\u7DE8\u8F2F"),P={key:0},Q=d("td",{colspan:"4",class:"text-center"},"\u6C92\u6709\u6703\u54E1",-1),X=[Q],Y=d("div",{class:"text-h5"},"\u7DE8\u8F2F\u6703\u54E1\u8CC7\u6599",-1),Z=c("\u522A\u9664"),ee=c("\u53D6\u6D88"),le=c("\u78BA\u8A8D\u9001\u51FA"),ce={__name:"UsersView",setup(te){const i=V([]),g=R();S(g);const e=V({_id:"",account:"",email:"",role:!1,dialog:!1,valid:!1,submitting:!1,idx:-1}),f=V({required(a){return!!a||"\u5FC5\u586B"},email(a){return G.exports.isEmail(a)||"\u4FE1\u7BB1\u683C\u5F0F\u932F\u8AA4"}}),y=(a,t)=>{e._id=i[t]._id,e.email=i[t].email,e.account=i[t].account,e.role=i[t].role,e.idx=t,e.dialog=!0,e.valid=!1,e.submitting=!1},k=async()=>{if(!!e.valid){e.submitting=!0;try{const{data:a}=await v.patch("/users/"+e._id,e);i[e.idx]=a.result,_.fire({title:"success //\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"}),e.dialog=!1}catch(a){_.fire({title:"ERROR //\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}e.submitting=!1}},U=async a=>{const t=await g.delUser(e._id);console.log(t),i.splice(a,1)};return(async()=>{try{const{data:a}=await v.get("/users/all");i.push(...a.result)}catch(a){console.log(a),_.fire({title:"ERROR //\u5931\u6557",text:a.isAxiosError?a.response.data.message:a.message})}})(),(a,t)=>(n(),u("div",H,[l(b,null,{default:o(()=>[l(r,{cols:"12"},{default:o(()=>[I]),_:1}),l(E),l(r,{cols:"12"},{default:o(()=>[l(T,{"fixed-header":""},{default:o(()=>[J,d("tbody",null,[(n(!0),u(A,null,B(i,(s,w)=>(n(),u("tr",{key:s._id},[d("td",null,p(s._id),1),d("td",null,p(s.email),1),d("td",null,p(s.account),1),d("td",null,[l(W,{olor:"success",modelValue:s.role,"onUpdate:modelValue":x=>s.role=x,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),d("td",null,[l(m,{onClick:x=>y(s._id,w),variant:"outlined",plain:"",size:"x-small",rounded:"lg"},{default:o(()=>[K]),_:2},1032,["onClick"])])]))),128)),i.length===0?(n(),u("tr",P,X)):D("",!0)])]),_:1})]),_:1})]),_:1}),l(z,{modelValue:e.dialog,"onUpdate:modelValue":t[6]||(t[6]=s=>e.dialog=s)},{default:o(()=>[l(F,{rounded:"xl"},{default:o(()=>[l(L,{modelValue:e.valid,"onUpdate:modelValue":t[5]||(t[5]=s=>e.valid=s),onSubmit:N(k,["prevent"])},{default:o(()=>[l(q,null,{default:o(()=>[Y]),_:1}),l($,null,{default:o(()=>[l(h,null,{default:o(()=>[l(b,null,{default:o(()=>[l(r,{cols:"12"},{default:o(()=>[l(C,{label:"\u4FE1\u7BB1",modelValue:e.email,"onUpdate:modelValue":t[0]||(t[0]=s=>e.email=s),rules:[f.required,f.email],type:"text"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(C,{label:"\u5E33\u865F",modelValue:e.account,"onUpdate:modelValue":t[1]||(t[1]=s=>e.account=s),rules:[f.required],type:"text"},null,8,["modelValue","rules"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(M,{label:"(\u6253\u52FE)\u7BA1\u7406\u54E1",modelValue:e.role,"onUpdate:modelValue":t[2]||(t[2]=s=>e.role=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(j,null,{default:o(()=>[l(h,{class:"d-flex"},{default:o(()=>[l(m,{onClick:t[3]||(t[3]=s=>U(a.idx)),color:"error"},{default:o(()=>[Z]),_:1}),l(O),l(m,{onClick:t[4]||(t[4]=s=>e.dialog=!1),color:"error",variant:"tonal",disadled:e.submitting},{default:o(()=>[ee]),_:1},8,["disadled"]),l(m,{type:"submit",variant:"tonal",loading:e.submitting},{default:o(()=>[le]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}};export{ce as default};
